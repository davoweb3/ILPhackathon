{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar UnsupportedOperationException_1 = require(\"../UnsupportedOperationException\");\nvar CharacterSetECI_1 = require(\"../common/CharacterSetECI\");\n/**\n * Responsible for en/decoding strings.\n */\nvar StringEncoding = /** @class */function () {\n  function StringEncoding() {}\n  /**\n   * Decodes some Uint8Array to a string format.\n   */\n  StringEncoding.decode = function (bytes, encoding) {\n    var encodingName = this.encodingName(encoding);\n    if (this.customDecoder) {\n      return this.customDecoder(bytes, encodingName);\n    }\n    // Increases browser support.\n    if (typeof TextDecoder === 'undefined' || this.shouldDecodeOnFallback(encodingName)) {\n      return this.decodeFallback(bytes, encodingName);\n    }\n    return new TextDecoder(encodingName).decode(bytes);\n  };\n  /**\n   * Checks if the decoding method should use the fallback for decoding\n   * once Node TextDecoder doesn't support all encoding formats.\n   *\n   * @param encodingName\n   */\n  StringEncoding.shouldDecodeOnFallback = function (encodingName) {\n    return !StringEncoding.isBrowser() && encodingName === 'ISO-8859-1';\n  };\n  /**\n   * Encodes some string into a Uint8Array.\n   */\n  StringEncoding.encode = function (s, encoding) {\n    var encodingName = this.encodingName(encoding);\n    if (this.customEncoder) {\n      return this.customEncoder(s, encodingName);\n    }\n    // Increases browser support.\n    if (typeof TextEncoder === 'undefined') {\n      return this.encodeFallback(s);\n    }\n    // TextEncoder only encodes to UTF8 by default as specified by encoding.spec.whatwg.org\n    return new TextEncoder().encode(s);\n  };\n  StringEncoding.isBrowser = function () {\n    return typeof window !== 'undefined' && {}.toString.call(window) === '[object Window]';\n  };\n  /**\n   * Returns the string value from some encoding character set.\n   */\n  StringEncoding.encodingName = function (encoding) {\n    return typeof encoding === 'string' ? encoding : encoding.getName();\n  };\n  /**\n   * Returns character set from some encoding character set.\n   */\n  StringEncoding.encodingCharacterSet = function (encoding) {\n    if (encoding instanceof CharacterSetECI_1.default) {\n      return encoding;\n    }\n    return CharacterSetECI_1.default.getCharacterSetECIByName(encoding);\n  };\n  /**\n   * Runs a fallback for the native decoding funcion.\n   */\n  StringEncoding.decodeFallback = function (bytes, encoding) {\n    var characterSet = this.encodingCharacterSet(encoding);\n    if (StringEncoding.isDecodeFallbackSupported(characterSet)) {\n      var s = '';\n      for (var i = 0, length_1 = bytes.length; i < length_1; i++) {\n        var h = bytes[i].toString(16);\n        if (h.length < 2) {\n          h = '0' + h;\n        }\n        s += '%' + h;\n      }\n      return decodeURIComponent(s);\n    }\n    if (characterSet.equals(CharacterSetECI_1.default.UnicodeBigUnmarked)) {\n      return String.fromCharCode.apply(null, new Uint16Array(bytes.buffer));\n    }\n    throw new UnsupportedOperationException_1.default(\"Encoding \" + this.encodingName(encoding) + \" not supported by fallback.\");\n  };\n  StringEncoding.isDecodeFallbackSupported = function (characterSet) {\n    return characterSet.equals(CharacterSetECI_1.default.UTF8) || characterSet.equals(CharacterSetECI_1.default.ISO8859_1) || characterSet.equals(CharacterSetECI_1.default.ASCII);\n  };\n  /**\n   * Runs a fallback for the native encoding funcion.\n   *\n   * @see https://stackoverflow.com/a/17192845/4367683\n   */\n  StringEncoding.encodeFallback = function (s) {\n    var encodedURIstring = btoa(unescape(encodeURIComponent(s)));\n    var charList = encodedURIstring.split('');\n    var uintArray = [];\n    for (var i = 0; i < charList.length; i++) {\n      uintArray.push(charList[i].charCodeAt(0));\n    }\n    return new Uint8Array(uintArray);\n  };\n  return StringEncoding;\n}();\nexports.default = StringEncoding;","map":{"version":3,"names":["UnsupportedOperationException_1","require","CharacterSetECI_1","StringEncoding","decode","bytes","encoding","encodingName","customDecoder","TextDecoder","shouldDecodeOnFallback","decodeFallback","isBrowser","encode","s","customEncoder","TextEncoder","encodeFallback","window","toString","call","getName","encodingCharacterSet","default","getCharacterSetECIByName","characterSet","isDecodeFallbackSupported","i","length_1","length","h","decodeURIComponent","equals","UnicodeBigUnmarked","String","fromCharCode","apply","Uint16Array","buffer","UTF8","ISO8859_1","ASCII","encodedURIstring","btoa","unescape","encodeURIComponent","charList","split","uintArray","push","charCodeAt","Uint8Array"],"sources":["../../../src/core/util/StringEncoding.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script"}