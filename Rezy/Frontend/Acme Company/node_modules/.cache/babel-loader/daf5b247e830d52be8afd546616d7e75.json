{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2008 ZXing authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar BarcodeFormat_1 = require(\"../BarcodeFormat\");\nvar DecodeHintType_1 = require(\"../DecodeHintType\");\nvar Result_1 = require(\"../Result\");\nvar ResultMetadataType_1 = require(\"../ResultMetadataType\");\nvar ResultPoint_1 = require(\"../ResultPoint\");\nvar UPCEANExtensionSupport_1 = require(\"./UPCEANExtensionSupport\");\nvar AbstractUPCEANReader_1 = require(\"./AbstractUPCEANReader\");\nvar NotFoundException_1 = require(\"../NotFoundException\");\nvar FormatException_1 = require(\"../FormatException\");\nvar ChecksumException_1 = require(\"../ChecksumException\");\n/**\n * <p>Encapsulates functionality and implementation that is common to UPC and EAN families\n * of one-dimensional barcodes.</p>\n *\n * @author dswitkin@google.com (Daniel Switkin)\n * @author Sean Owen\n * @author alasdair@google.com (Alasdair Mackintosh)\n */\nvar UPCEANReader = /** @class */function (_super) {\n  __extends(UPCEANReader, _super);\n  function UPCEANReader() {\n    var _this = _super.call(this) || this;\n    _this.decodeRowStringBuffer = '';\n    UPCEANReader.L_AND_G_PATTERNS = UPCEANReader.L_PATTERNS.map(function (arr) {\n      return arr.slice();\n    });\n    for (var i = 10; i < 20; i++) {\n      var widths = UPCEANReader.L_PATTERNS[i - 10];\n      var reversedWidths = new Array(widths.length);\n      for (var j = 0; j < widths.length; j++) {\n        reversedWidths[j] = widths[widths.length - j - 1];\n      }\n      UPCEANReader.L_AND_G_PATTERNS[i] = reversedWidths;\n    }\n    return _this;\n  }\n  UPCEANReader.prototype.decodeRow = function (rowNumber, row, hints) {\n    var startGuardRange = UPCEANReader.findStartGuardPattern(row);\n    var resultPointCallback = hints == null ? null : hints.get(DecodeHintType_1.default.NEED_RESULT_POINT_CALLBACK);\n    if (resultPointCallback != null) {\n      var resultPoint_1 = new ResultPoint_1.default((startGuardRange[0] + startGuardRange[1]) / 2.0, rowNumber);\n      resultPointCallback.foundPossibleResultPoint(resultPoint_1);\n    }\n    var budello = this.decodeMiddle(row, startGuardRange, this.decodeRowStringBuffer);\n    var endStart = budello.rowOffset;\n    var result = budello.resultString;\n    if (resultPointCallback != null) {\n      var resultPoint_2 = new ResultPoint_1.default(endStart, rowNumber);\n      resultPointCallback.foundPossibleResultPoint(resultPoint_2);\n    }\n    var endRange = UPCEANReader.decodeEnd(row, endStart);\n    if (resultPointCallback != null) {\n      var resultPoint_3 = new ResultPoint_1.default((endRange[0] + endRange[1]) / 2.0, rowNumber);\n      resultPointCallback.foundPossibleResultPoint(resultPoint_3);\n    }\n    // Make sure there is a quiet zone at least as big as the end pattern after the barcode. The\n    // spec might want more whitespace, but in practice this is the maximum we can count on.\n    var end = endRange[1];\n    var quietEnd = end + (end - endRange[0]);\n    if (quietEnd >= row.getSize() || !row.isRange(end, quietEnd, false)) {\n      throw new NotFoundException_1.default();\n    }\n    var resultString = result.toString();\n    // UPC/EAN should never be less than 8 chars anyway\n    if (resultString.length < 8) {\n      throw new FormatException_1.default();\n    }\n    if (!UPCEANReader.checkChecksum(resultString)) {\n      throw new ChecksumException_1.default();\n    }\n    var left = (startGuardRange[1] + startGuardRange[0]) / 2.0;\n    var right = (endRange[1] + endRange[0]) / 2.0;\n    var format = this.getBarcodeFormat();\n    var resultPoint = [new ResultPoint_1.default(left, rowNumber), new ResultPoint_1.default(right, rowNumber)];\n    var decodeResult = new Result_1.default(resultString, null, 0, resultPoint, format, new Date().getTime());\n    var extensionLength = 0;\n    try {\n      var extensionResult = UPCEANExtensionSupport_1.default.decodeRow(rowNumber, row, endRange[1]);\n      decodeResult.putMetadata(ResultMetadataType_1.default.UPC_EAN_EXTENSION, extensionResult.getText());\n      decodeResult.putAllMetadata(extensionResult.getResultMetadata());\n      decodeResult.addResultPoints(extensionResult.getResultPoints());\n      extensionLength = extensionResult.getText().length;\n    } catch (err) {}\n    var allowedExtensions = hints == null ? null : hints.get(DecodeHintType_1.default.ALLOWED_EAN_EXTENSIONS);\n    if (allowedExtensions != null) {\n      var valid = false;\n      for (var length_1 in allowedExtensions) {\n        if (extensionLength.toString() === length_1) {\n          // check me\n          valid = true;\n          break;\n        }\n      }\n      if (!valid) {\n        throw new NotFoundException_1.default();\n      }\n    }\n    if (format === BarcodeFormat_1.default.EAN_13 || format === BarcodeFormat_1.default.UPC_A) {\n      // let countryID = eanManSupport.lookupContryIdentifier(resultString); todo\n      // if (countryID != null) {\n      //     decodeResult.putMetadata(ResultMetadataType.POSSIBLE_COUNTRY, countryID);\n      // }\n    }\n    return decodeResult;\n  };\n  UPCEANReader.checkChecksum = function (s) {\n    return UPCEANReader.checkStandardUPCEANChecksum(s);\n  };\n  UPCEANReader.checkStandardUPCEANChecksum = function (s) {\n    var length = s.length;\n    if (length === 0) return false;\n    var check = parseInt(s.charAt(length - 1), 10);\n    return UPCEANReader.getStandardUPCEANChecksum(s.substring(0, length - 1)) === check;\n  };\n  UPCEANReader.getStandardUPCEANChecksum = function (s) {\n    var length = s.length;\n    var sum = 0;\n    for (var i = length - 1; i >= 0; i -= 2) {\n      var digit = s.charAt(i).charCodeAt(0) - '0'.charCodeAt(0);\n      if (digit < 0 || digit > 9) {\n        throw new FormatException_1.default();\n      }\n      sum += digit;\n    }\n    sum *= 3;\n    for (var i = length - 2; i >= 0; i -= 2) {\n      var digit = s.charAt(i).charCodeAt(0) - '0'.charCodeAt(0);\n      if (digit < 0 || digit > 9) {\n        throw new FormatException_1.default();\n      }\n      sum += digit;\n    }\n    return (1000 - sum) % 10;\n  };\n  UPCEANReader.decodeEnd = function (row, endStart) {\n    return UPCEANReader.findGuardPattern(row, endStart, false, UPCEANReader.START_END_PATTERN, new Array(UPCEANReader.START_END_PATTERN.length).fill(0));\n  };\n  return UPCEANReader;\n}(AbstractUPCEANReader_1.default);\nexports.default = UPCEANReader;","map":{"version":3,"names":["BarcodeFormat_1","require","DecodeHintType_1","Result_1","ResultMetadataType_1","ResultPoint_1","UPCEANExtensionSupport_1","AbstractUPCEANReader_1","NotFoundException_1","FormatException_1","ChecksumException_1","UPCEANReader","_super","__extends","_this","call","decodeRowStringBuffer","L_AND_G_PATTERNS","L_PATTERNS","map","arr","slice","i","widths","reversedWidths","Array","length","j","prototype","decodeRow","rowNumber","row","hints","startGuardRange","findStartGuardPattern","resultPointCallback","get","default","NEED_RESULT_POINT_CALLBACK","resultPoint_1","foundPossibleResultPoint","budello","decodeMiddle","endStart","rowOffset","result","resultString","resultPoint_2","endRange","decodeEnd","resultPoint_3","end","quietEnd","getSize","isRange","toString","checkChecksum","left","right","format","getBarcodeFormat","resultPoint","decodeResult","Date","getTime","extensionLength","extensionResult","putMetadata","UPC_EAN_EXTENSION","getText","putAllMetadata","getResultMetadata","addResultPoints","getResultPoints","err","allowedExtensions","ALLOWED_EAN_EXTENSIONS","valid","length_1","EAN_13","UPC_A","s","checkStandardUPCEANChecksum","check","parseInt","charAt","getStandardUPCEANChecksum","substring","sum","digit","charCodeAt","findGuardPattern","START_END_PATTERN","fill"],"sources":["../../../src/core/oned/UPCEANReader.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script"}