{"ast":null,"code":"import _slicedToArray from\"C:/Users/DAVOTRADE/Desktop/Rezy barcode/scanner/scanner/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import\"./Scan.css\";import ButtonStyle from\"../components/button\";import ModalStyle from\"../components/Modal\";import React,{useState}from\"react\";import QrReader from\"react-qr-reader\";import{Grid}from\"@material-ui/core\";import{useNavigate}from\"react-router-dom\";import Barcode from\"react-barcode\";import BarcodeScannerComponent from\"react-qr-barcode-scanner\";import products from'../products.json';// const URL = \"https://backend-products-scan.onrender.com:3500\";\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var URL='http://localhost:3500';function Scan(){var initialData=products;var _useState=useState(\"No result\"),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),producto=_useState4[0],setProducto=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),stopStream=_useState6[0],setStopStream=_useState6[1];var _useState7=useState(initialData),_useState8=_slicedToArray(_useState7,2),filteredData=_useState8[0],setFilteredData=_useState8[1];var navigate=useNavigate();var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),open=_useState10[0],setOpen=_useState10[1];var handleClose=function handleClose(){postToArduino(\"0\");setOpen(false);};var postToArduino=function postToArduino(option){var headers={\"Content-Type\":\"text/html\"};var url=\"https://rezy.lat/esp-outputs-action.php?action=output_update&id=1&state=\".concat(option);fetch(url,{headers:headers}).then(function(response){if(response.status===200){setData(\"Green led is on\");}else{setData(\"Green led is off\");}}).catch(function(err){console.log(err);setOpen(false);});};var handleAccept=function handleAccept(){postToArduino(\"1\");setTimeout(function(){postToArduino(\"0\");setOpen(false);navigate(\"/step3\");},2000);};var handleErrorWebCam=function handleErrorWebCam(error){console.log(error);};var parseAndSendToEndpoint=function parseAndSendToEndpoint(result){// Create an object to hold the data to be sent\nvar dataToSend={result:result};// Define the headers for the POST request\nvar headers={'Content-Type':'application/json'};// Make the POST request to the endpoint\nfetch('http://127.0.0.1:3500',{method:'POST',headers:headers,body:JSON.stringify(dataToSend)}).then(function(response){if(response.status===200){// Request was successful\nreturn response.json();}else{// Handle errors here\nconsole.error('Error sending data to the endpoint');}}).then(function(responseData){// Handle the response from the endpoint if needed\nconsole.log('Response from endpoint:',responseData);}).catch(function(error){// Handle any network errors here\nconsole.error('Network error:',error);});};var handleScanWebCam=function handleScanWebCam(result){if(result){var resultText=result.toString();// Convert result to a string\nsetData(resultText);if(!open){getProduct(resultText);// Use resultText to fetch the product\n}// Call the function to parse and send the data\nparseAndSendToEndpoint(resultText);}};var getProduct=function getProduct(id){var foundElement=filteredData.find(function(item){return item.Id===id;});if(foundElement){// Do something with the found element\nsetProducto(foundElement);setOpen(true);}else{// Element with the given id was not found\nconsole.log('Element not found');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"title\",children:\"Step 1\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Scan a selected product listed on www.rezy.com, aim to the camera and\"}),/*#__PURE__*/_jsx(\"p\",{children:\" Wait for the confirmation popup, once the bottle is recognized your bottle will be added to your wallet.\"}),/*#__PURE__*/_jsx(Grid,{container:true,style:{width:window.innerWidth<1000?\"100%\":\"25%\"},children:/*#__PURE__*/_jsx(Grid,{item:true,xl:12,lg:12,md:12,sm:12,xs:12,children:/*#__PURE__*/_jsx(BarcodeScannerComponent,{width:500,height:500// stopStream={stopStream}\n,onUpdate:function onUpdate(err,result){if(result){handleScanWebCam(result.text);console.log(result);// setData(result.text);\n// setStopStream(true);\n}else{setData(\"Not Found\");}}})})}),/*#__PURE__*/_jsx(\"p\",{children:data}),/*#__PURE__*/_jsx(ButtonStyle,{Text:\"Scan!\"})]}),/*#__PURE__*/_jsx(ModalStyle,{flag:open,close:handleClose,product:producto,accept:handleAccept})]});}export default Scan;","map":{"version":3,"names":["ButtonStyle","ModalStyle","React","useState","QrReader","Grid","useNavigate","Barcode","BarcodeScannerComponent","products","jsx","_jsx","jsxs","_jsxs","URL","Scan","initialData","_useState","_useState2","_slicedToArray","data","setData","_useState3","_useState4","producto","setProducto","_useState5","_useState6","stopStream","setStopStream","_useState7","_useState8","filteredData","setFilteredData","navigate","_useState9","_useState10","open","setOpen","handleClose","postToArduino","option","headers","url","concat","fetch","then","response","status","catch","err","console","log","handleAccept","setTimeout","handleErrorWebCam","error","parseAndSendToEndpoint","result","dataToSend","method","body","JSON","stringify","json","responseData","handleScanWebCam","resultText","toString","getProduct","id","foundElement","find","item","Id","className","children","container","style","width","window","innerWidth","xl","lg","md","sm","xs","height","onUpdate","text","Text","flag","close","product","accept"],"sources":["C:/Users/DAVOTRADE/Desktop/Rezy barcode/scanner/scanner/src/scan/Scan.js"],"sourcesContent":["import \"./Scan.css\";\nimport ButtonStyle from \"../components/button\";\nimport ModalStyle from \"../components/Modal\";\nimport React, { useState } from \"react\";\nimport QrReader from \"react-qr-reader\";\nimport { Grid } from \"@material-ui/core\";\nimport { useNavigate } from \"react-router-dom\";\nimport Barcode from \"react-barcode\";\nimport BarcodeScannerComponent from \"react-qr-barcode-scanner\";\nimport products from '../products.json'\n\n// const URL = \"https://backend-products-scan.onrender.com:3500\";\nconst URL = 'http://localhost:3500';\n\nfunction Scan() {\n  const initialData = products\n  const [data, setData] = useState(\"No result\");\n  const [producto, setProducto] = useState({});\n  const [stopStream, setStopStream] = useState(false);\n  const [filteredData, setFilteredData] = useState(initialData);\n\n  let navigate = useNavigate();\n\n  const [open, setOpen] = useState(false);\n  const handleClose = () => {\n    postToArduino(\"0\");\n    setOpen(false);\n  };\n\n  const postToArduino = (option) => {\n    const headers = {\n      \"Content-Type\": \"text/html\",\n    };\n    let url = `https://rezy.lat/esp-outputs-action.php?action=output_update&id=1&state=${option}`;\n    fetch(url, { headers })\n      .then((response) => {\n        if (response.status === 200) {\n          setData(\"Green led is on\");\n        } else {\n          setData(\"Green led is off\");\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n        setOpen(false);\n      });\n  };\n\n  const handleAccept = () => {\n    postToArduino(\"1\");\n    setTimeout(function () {\n      postToArduino(\"0\");\n      setOpen(false);\n      navigate(\"/step3\");\n    }, 2000);\n  };\n\n  const handleErrorWebCam = (error) => {\n    console.log(error);\n  };\n\n  const parseAndSendToEndpoint = (result) => {\n    // Create an object to hold the data to be sent\n    const dataToSend = { result: result };\n\n    // Define the headers for the POST request\n    const headers = {\n      'Content-Type': 'application/json',\n    };\n\n    // Make the POST request to the endpoint\n    fetch('http://127.0.0.1:3500', {\n      method: 'POST',\n      headers: headers,\n      body: JSON.stringify(dataToSend),\n    })\n      .then((response) => {\n        if (response.status === 200) {\n          // Request was successful\n          return response.json();\n        } else {\n          // Handle errors here\n          console.error('Error sending data to the endpoint');\n        }\n      })\n      .then((responseData) => {\n        // Handle the response from the endpoint if needed\n        console.log('Response from endpoint:', responseData);\n      })\n      .catch((error) => {\n        // Handle any network errors here\n        console.error('Network error:', error);\n      });\n  };\n\n  const handleScanWebCam = (result) => {\n  if (result) {\n    const resultText = result.toString(); // Convert result to a string\n    setData(resultText);\n    if (!open) {\n      getProduct(resultText); // Use resultText to fetch the product\n    }\n    // Call the function to parse and send the data\n    parseAndSendToEndpoint(resultText);\n  }\n};\n\n  const getProduct = (id) => {\n    const foundElement = filteredData.find(item => item.Id === id);\n\n    if (foundElement) {\n      // Do something with the found element\n      setProducto(foundElement);\n      setOpen(true);\n    } else {\n      // Element with the given id was not found\n      console.log('Element not found');\n    }\n  };\n\n  return (\n    <div className=\"App\">\n      <div className=\"container\">\n        <label className=\"title\">Step 1</label>\n        <p>\n          Scan a selected product listed on www.rezy.com, aim to the camera and</p>\n          <p> Wait for the confirmation popup, once the bottle is recognized your bottle will be added to your wallet.</p>\n        \n\n        <Grid\n          container\n          style={{ width: window.innerWidth < 1000 ? \"100%\" : \"25%\" }}\n        >\n          <Grid item xl={12} lg={12} md={12} sm={12} xs={12}>\n            <BarcodeScannerComponent\n              width={500}\n              height={500}\n              // stopStream={stopStream}\n              onUpdate={(err, result) => {\n                if (result) {\n                  handleScanWebCam(result.text)\n                  console.log(result);\n                 \n                  // setData(result.text);\n                  // setStopStream(true);\n                } else {\n                  setData(\"Not Found\");\n                }\n              }}\n            />\n          </Grid>\n        </Grid>\n\n        <p>{data}</p>\n        <ButtonStyle Text={\"Scan!\"}></ButtonStyle>\n      </div>\n      <ModalStyle\n        flag={open}\n        close={handleClose}\n        product={producto}\n        accept={handleAccept}\n      ></ModalStyle>\n    </div>\n  );\n}\n\nexport default Scan;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}