{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __values = this && this.__values || function (o) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator],\n    i = 0;\n  if (m) return m.call(o);\n  return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar AbstractRSSReader_1 = require(\"./AbstractRSSReader\");\nvar Pair_1 = require(\"./Pair\");\nvar Result_1 = require(\"../../Result\");\nvar DecodeHintType_1 = require(\"../../DecodeHintType\");\nvar NotFoundException_1 = require(\"../../NotFoundException\");\nvar StringBuilder_1 = require(\"../../util/StringBuilder\");\nvar BarcodeFormat_1 = require(\"../../BarcodeFormat\");\nvar ResultPoint_1 = require(\"../../ResultPoint\");\nvar FinderPattern_1 = require(\"./FinderPattern\");\nvar DataCharacter_1 = require(\"./DataCharacter\");\nvar MathUtils_1 = require(\"../../common/detector/MathUtils\");\nvar RSSUtils_1 = require(\"./RSSUtils\");\nvar System_1 = require(\"../../util/System\");\nvar OneDReader_1 = require(\"../OneDReader\");\nvar RSS14Reader = /** @class */function (_super) {\n  __extends(RSS14Reader, _super);\n  function RSS14Reader() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.possibleLeftPairs = [];\n    _this.possibleRightPairs = [];\n    return _this;\n  }\n  RSS14Reader.prototype.decodeRow = function (rowNumber, row, hints) {\n    var e_1, _a, e_2, _b;\n    var leftPair = this.decodePair(row, false, rowNumber, hints);\n    RSS14Reader.addOrTally(this.possibleLeftPairs, leftPair);\n    row.reverse();\n    var rightPair = this.decodePair(row, true, rowNumber, hints);\n    RSS14Reader.addOrTally(this.possibleRightPairs, rightPair);\n    row.reverse();\n    try {\n      for (var _c = __values(this.possibleLeftPairs), _d = _c.next(); !_d.done; _d = _c.next()) {\n        var left = _d.value;\n        if (left.getCount() > 1) {\n          try {\n            for (var _e = __values(this.possibleRightPairs), _f = _e.next(); !_f.done; _f = _e.next()) {\n              var right = _f.value;\n              if (right.getCount() > 1 && RSS14Reader.checkChecksum(left, right)) {\n                return RSS14Reader.constructResult(left, right);\n              }\n            }\n          } catch (e_2_1) {\n            e_2 = {\n              error: e_2_1\n            };\n          } finally {\n            try {\n              if (_f && !_f.done && (_b = _e.return)) _b.call(_e);\n            } finally {\n              if (e_2) throw e_2.error;\n            }\n          }\n        }\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n    throw new NotFoundException_1.default();\n  };\n  RSS14Reader.addOrTally = function (possiblePairs, pair) {\n    var e_3, _a;\n    if (pair == null) {\n      return;\n    }\n    var found = false;\n    try {\n      for (var possiblePairs_1 = __values(possiblePairs), possiblePairs_1_1 = possiblePairs_1.next(); !possiblePairs_1_1.done; possiblePairs_1_1 = possiblePairs_1.next()) {\n        var other = possiblePairs_1_1.value;\n        if (other.getValue() === pair.getValue()) {\n          other.incrementCount();\n          found = true;\n          break;\n        }\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (possiblePairs_1_1 && !possiblePairs_1_1.done && (_a = possiblePairs_1.return)) _a.call(possiblePairs_1);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n    if (!found) {\n      possiblePairs.push(pair);\n    }\n  };\n  RSS14Reader.prototype.reset = function () {\n    this.possibleLeftPairs.length = 0;\n    this.possibleRightPairs.length = 0;\n  };\n  RSS14Reader.constructResult = function (leftPair, rightPair) {\n    var symbolValue = 4537077 * leftPair.getValue() + rightPair.getValue();\n    var text = new String(symbolValue).toString();\n    var buffer = new StringBuilder_1.default();\n    for (var i = 13 - text.length; i > 0; i--) {\n      buffer.append('0');\n    }\n    buffer.append(text);\n    var checkDigit = 0;\n    for (var i = 0; i < 13; i++) {\n      var digit = buffer.charAt(i).charCodeAt(0) - '0'.charCodeAt(0);\n      checkDigit += (i & 0x01) === 0 ? 3 * digit : digit;\n    }\n    checkDigit = 10 - checkDigit % 10;\n    if (checkDigit === 10) {\n      checkDigit = 0;\n    }\n    buffer.append(checkDigit.toString());\n    var leftPoints = leftPair.getFinderPattern().getResultPoints();\n    var rightPoints = rightPair.getFinderPattern().getResultPoints();\n    return new Result_1.default(buffer.toString(), null, 0, [leftPoints[0], leftPoints[1], rightPoints[0], rightPoints[1]], BarcodeFormat_1.default.RSS_14, new Date().getTime());\n  };\n  RSS14Reader.checkChecksum = function (leftPair, rightPair) {\n    var checkValue = (leftPair.getChecksumPortion() + 16 * rightPair.getChecksumPortion()) % 79;\n    var targetCheckValue = 9 * leftPair.getFinderPattern().getValue() + rightPair.getFinderPattern().getValue();\n    if (targetCheckValue > 72) {\n      targetCheckValue--;\n    }\n    if (targetCheckValue > 8) {\n      targetCheckValue--;\n    }\n    return checkValue === targetCheckValue;\n  };\n  RSS14Reader.prototype.decodePair = function (row, right, rowNumber, hints) {\n    try {\n      var startEnd = this.findFinderPattern(row, right);\n      var pattern = this.parseFoundFinderPattern(row, rowNumber, right, startEnd);\n      var resultPointCallback = hints == null ? null : hints.get(DecodeHintType_1.default.NEED_RESULT_POINT_CALLBACK);\n      if (resultPointCallback != null) {\n        var center = (startEnd[0] + startEnd[1]) / 2.0;\n        if (right) {\n          // row is actually reversed\n          center = row.getSize() - 1 - center;\n        }\n        resultPointCallback.foundPossibleResultPoint(new ResultPoint_1.default(center, rowNumber));\n      }\n      var outside = this.decodeDataCharacter(row, pattern, true);\n      var inside = this.decodeDataCharacter(row, pattern, false);\n      return new Pair_1.default(1597 * outside.getValue() + inside.getValue(), outside.getChecksumPortion() + 4 * inside.getChecksumPortion(), pattern);\n    } catch (err) {\n      return null;\n    }\n  };\n  RSS14Reader.prototype.decodeDataCharacter = function (row, pattern, outsideChar) {\n    var counters = this.getDataCharacterCounters();\n    for (var x = 0; x < counters.length; x++) {\n      counters[x] = 0;\n    }\n    if (outsideChar) {\n      OneDReader_1.default.recordPatternInReverse(row, pattern.getStartEnd()[0], counters);\n    } else {\n      OneDReader_1.default.recordPattern(row, pattern.getStartEnd()[1] + 1, counters);\n      // reverse it\n      for (var i = 0, j = counters.length - 1; i < j; i++, j--) {\n        var temp = counters[i];\n        counters[i] = counters[j];\n        counters[j] = temp;\n      }\n    }\n    var numModules = outsideChar ? 16 : 15;\n    var elementWidth = MathUtils_1.default.sum(new Int32Array(counters)) / numModules;\n    var oddCounts = this.getOddCounts();\n    var evenCounts = this.getEvenCounts();\n    var oddRoundingErrors = this.getOddRoundingErrors();\n    var evenRoundingErrors = this.getEvenRoundingErrors();\n    for (var i = 0; i < counters.length; i++) {\n      var value = counters[i] / elementWidth;\n      var count = Math.floor(value + 0.5);\n      if (count < 1) {\n        count = 1;\n      } else if (count > 8) {\n        count = 8;\n      }\n      var offset = Math.floor(i / 2);\n      if ((i & 0x01) === 0) {\n        oddCounts[offset] = count;\n        oddRoundingErrors[offset] = value - count;\n      } else {\n        evenCounts[offset] = count;\n        evenRoundingErrors[offset] = value - count;\n      }\n    }\n    this.adjustOddEvenCounts(outsideChar, numModules);\n    var oddSum = 0;\n    var oddChecksumPortion = 0;\n    for (var i = oddCounts.length - 1; i >= 0; i--) {\n      oddChecksumPortion *= 9;\n      oddChecksumPortion += oddCounts[i];\n      oddSum += oddCounts[i];\n    }\n    var evenChecksumPortion = 0;\n    var evenSum = 0;\n    for (var i = evenCounts.length - 1; i >= 0; i--) {\n      evenChecksumPortion *= 9;\n      evenChecksumPortion += evenCounts[i];\n      evenSum += evenCounts[i];\n    }\n    var checksumPortion = oddChecksumPortion + 3 * evenChecksumPortion;\n    if (outsideChar) {\n      if ((oddSum & 0x01) !== 0 || oddSum > 12 || oddSum < 4) {\n        throw new NotFoundException_1.default();\n      }\n      var group = (12 - oddSum) / 2;\n      var oddWidest = RSS14Reader.OUTSIDE_ODD_WIDEST[group];\n      var evenWidest = 9 - oddWidest;\n      var vOdd = RSSUtils_1.default.getRSSvalue(oddCounts, oddWidest, false);\n      var vEven = RSSUtils_1.default.getRSSvalue(evenCounts, evenWidest, true);\n      var tEven = RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET[group];\n      var gSum = RSS14Reader.OUTSIDE_GSUM[group];\n      return new DataCharacter_1.default(vOdd * tEven + vEven + gSum, checksumPortion);\n    } else {\n      if ((evenSum & 0x01) !== 0 || evenSum > 10 || evenSum < 4) {\n        throw new NotFoundException_1.default();\n      }\n      var group = (10 - evenSum) / 2;\n      var oddWidest = RSS14Reader.INSIDE_ODD_WIDEST[group];\n      var evenWidest = 9 - oddWidest;\n      var vOdd = RSSUtils_1.default.getRSSvalue(oddCounts, oddWidest, true);\n      var vEven = RSSUtils_1.default.getRSSvalue(evenCounts, evenWidest, false);\n      var tOdd = RSS14Reader.INSIDE_ODD_TOTAL_SUBSET[group];\n      var gSum = RSS14Reader.INSIDE_GSUM[group];\n      return new DataCharacter_1.default(vEven * tOdd + vOdd + gSum, checksumPortion);\n    }\n  };\n  RSS14Reader.prototype.findFinderPattern = function (row, rightFinderPattern) {\n    var counters = this.getDecodeFinderCounters();\n    counters[0] = 0;\n    counters[1] = 0;\n    counters[2] = 0;\n    counters[3] = 0;\n    var width = row.getSize();\n    var isWhite = false;\n    var rowOffset = 0;\n    while (rowOffset < width) {\n      isWhite = !row.get(rowOffset);\n      if (rightFinderPattern === isWhite) {\n        // Will encounter white first when searching for right finder pattern\n        break;\n      }\n      rowOffset++;\n    }\n    var counterPosition = 0;\n    var patternStart = rowOffset;\n    for (var x = rowOffset; x < width; x++) {\n      if (row.get(x) !== isWhite) {\n        counters[counterPosition]++;\n      } else {\n        if (counterPosition === 3) {\n          if (AbstractRSSReader_1.default.isFinderPattern(counters)) {\n            return [patternStart, x];\n          }\n          patternStart += counters[0] + counters[1];\n          counters[0] = counters[2];\n          counters[1] = counters[3];\n          counters[2] = 0;\n          counters[3] = 0;\n          counterPosition--;\n        } else {\n          counterPosition++;\n        }\n        counters[counterPosition] = 1;\n        isWhite = !isWhite;\n      }\n    }\n    throw new NotFoundException_1.default();\n  };\n  RSS14Reader.prototype.parseFoundFinderPattern = function (row, rowNumber, right, startEnd) {\n    // Actually we found elements 2-5\n    var firstIsBlack = row.get(startEnd[0]);\n    var firstElementStart = startEnd[0] - 1;\n    // Locate element 1\n    while (firstElementStart >= 0 && firstIsBlack !== row.get(firstElementStart)) {\n      firstElementStart--;\n    }\n    firstElementStart++;\n    var firstCounter = startEnd[0] - firstElementStart;\n    // Make 'counters' hold 1-4\n    var counters = this.getDecodeFinderCounters();\n    var copy = new Array(counters.length);\n    System_1.default.arraycopy(counters, 0, copy, 1, counters.length - 1);\n    copy[0] = firstCounter;\n    var value = this.parseFinderValue(copy, RSS14Reader.FINDER_PATTERNS);\n    var start = firstElementStart;\n    var end = startEnd[1];\n    if (right) {\n      // row is actually reversed\n      start = row.getSize() - 1 - start;\n      end = row.getSize() - 1 - end;\n    }\n    return new FinderPattern_1.default(value, [firstElementStart, startEnd[1]], start, end, rowNumber);\n  };\n  RSS14Reader.prototype.adjustOddEvenCounts = function (outsideChar, numModules) {\n    var oddSum = MathUtils_1.default.sum(new Int32Array(this.getOddCounts()));\n    var evenSum = MathUtils_1.default.sum(new Int32Array(this.getEvenCounts()));\n    var incrementOdd = false;\n    var decrementOdd = false;\n    var incrementEven = false;\n    var decrementEven = false;\n    if (outsideChar) {\n      if (oddSum > 12) {\n        decrementOdd = true;\n      } else if (oddSum < 4) {\n        incrementOdd = true;\n      }\n      if (evenSum > 12) {\n        decrementEven = true;\n      } else if (evenSum < 4) {\n        incrementEven = true;\n      }\n    } else {\n      if (oddSum > 11) {\n        decrementOdd = true;\n      } else if (oddSum < 5) {\n        incrementOdd = true;\n      }\n      if (evenSum > 10) {\n        decrementEven = true;\n      } else if (evenSum < 4) {\n        incrementEven = true;\n      }\n    }\n    var mismatch = oddSum + evenSum - numModules;\n    var oddParityBad = (oddSum & 0x01) === (outsideChar ? 1 : 0);\n    var evenParityBad = (evenSum & 0x01) === 1;\n    if (mismatch === 1) {\n      if (oddParityBad) {\n        if (evenParityBad) {\n          throw new NotFoundException_1.default();\n        }\n        decrementOdd = true;\n      } else {\n        if (!evenParityBad) {\n          throw new NotFoundException_1.default();\n        }\n        decrementEven = true;\n      }\n    } else if (mismatch === -1) {\n      if (oddParityBad) {\n        if (evenParityBad) {\n          throw new NotFoundException_1.default();\n        }\n        incrementOdd = true;\n      } else {\n        if (!evenParityBad) {\n          throw new NotFoundException_1.default();\n        }\n        incrementEven = true;\n      }\n    } else if (mismatch === 0) {\n      if (oddParityBad) {\n        if (!evenParityBad) {\n          throw new NotFoundException_1.default();\n        }\n        // Both bad\n        if (oddSum < evenSum) {\n          incrementOdd = true;\n          decrementEven = true;\n        } else {\n          decrementOdd = true;\n          incrementEven = true;\n        }\n      } else {\n        if (evenParityBad) {\n          throw new NotFoundException_1.default();\n        }\n        // Nothing to do!\n      }\n    } else {\n      throw new NotFoundException_1.default();\n    }\n    if (incrementOdd) {\n      if (decrementOdd) {\n        throw new NotFoundException_1.default();\n      }\n      AbstractRSSReader_1.default.increment(this.getOddCounts(), this.getOddRoundingErrors());\n    }\n    if (decrementOdd) {\n      AbstractRSSReader_1.default.decrement(this.getOddCounts(), this.getOddRoundingErrors());\n    }\n    if (incrementEven) {\n      if (decrementEven) {\n        throw new NotFoundException_1.default();\n      }\n      AbstractRSSReader_1.default.increment(this.getEvenCounts(), this.getOddRoundingErrors());\n    }\n    if (decrementEven) {\n      AbstractRSSReader_1.default.decrement(this.getEvenCounts(), this.getEvenRoundingErrors());\n    }\n  };\n  RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET = [1, 10, 34, 70, 126];\n  RSS14Reader.INSIDE_ODD_TOTAL_SUBSET = [4, 20, 48, 81];\n  RSS14Reader.OUTSIDE_GSUM = [0, 161, 961, 2015, 2715];\n  RSS14Reader.INSIDE_GSUM = [0, 336, 1036, 1516];\n  RSS14Reader.OUTSIDE_ODD_WIDEST = [8, 6, 4, 3, 1];\n  RSS14Reader.INSIDE_ODD_WIDEST = [2, 4, 6, 8];\n  RSS14Reader.FINDER_PATTERNS = [[3, 8, 2, 1], [3, 5, 5, 1], [3, 3, 7, 1], [3, 1, 9, 1], [2, 7, 4, 1], [2, 5, 6, 1], [2, 3, 8, 1], [1, 5, 7, 1], [1, 3, 9, 1]];\n  return RSS14Reader;\n}(AbstractRSSReader_1.default);\nexports.default = RSS14Reader;","map":{"version":3,"sources":["../../../../src/core/oned/rss/RSS14Reader.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __values = (this && this.__values) || function (o) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\n    if (m) return m.call(o);\n    return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar AbstractRSSReader_1 = require(\"./AbstractRSSReader\");\nvar Pair_1 = require(\"./Pair\");\nvar Result_1 = require(\"../../Result\");\nvar DecodeHintType_1 = require(\"../../DecodeHintType\");\nvar NotFoundException_1 = require(\"../../NotFoundException\");\nvar StringBuilder_1 = require(\"../../util/StringBuilder\");\nvar BarcodeFormat_1 = require(\"../../BarcodeFormat\");\nvar ResultPoint_1 = require(\"../../ResultPoint\");\nvar FinderPattern_1 = require(\"./FinderPattern\");\nvar DataCharacter_1 = require(\"./DataCharacter\");\nvar MathUtils_1 = require(\"../../common/detector/MathUtils\");\nvar RSSUtils_1 = require(\"./RSSUtils\");\nvar System_1 = require(\"../../util/System\");\nvar OneDReader_1 = require(\"../OneDReader\");\nvar RSS14Reader = /** @class */ (function (_super) {\n    __extends(RSS14Reader, _super);\n    function RSS14Reader() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.possibleLeftPairs = [];\n        _this.possibleRightPairs = [];\n        return _this;\n    }\n    RSS14Reader.prototype.decodeRow = function (rowNumber, row, hints) {\n        var e_1, _a, e_2, _b;\n        var leftPair = this.decodePair(row, false, rowNumber, hints);\n        RSS14Reader.addOrTally(this.possibleLeftPairs, leftPair);\n        row.reverse();\n        var rightPair = this.decodePair(row, true, rowNumber, hints);\n        RSS14Reader.addOrTally(this.possibleRightPairs, rightPair);\n        row.reverse();\n        try {\n            for (var _c = __values(this.possibleLeftPairs), _d = _c.next(); !_d.done; _d = _c.next()) {\n                var left = _d.value;\n                if (left.getCount() > 1) {\n                    try {\n                        for (var _e = __values(this.possibleRightPairs), _f = _e.next(); !_f.done; _f = _e.next()) {\n                            var right = _f.value;\n                            if (right.getCount() > 1 && RSS14Reader.checkChecksum(left, right)) {\n                                return RSS14Reader.constructResult(left, right);\n                            }\n                        }\n                    }\n                    catch (e_2_1) { e_2 = { error: e_2_1 }; }\n                    finally {\n                        try {\n                            if (_f && !_f.done && (_b = _e.return)) _b.call(_e);\n                        }\n                        finally { if (e_2) throw e_2.error; }\n                    }\n                }\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        throw new NotFoundException_1.default();\n    };\n    RSS14Reader.addOrTally = function (possiblePairs, pair) {\n        var e_3, _a;\n        if (pair == null) {\n            return;\n        }\n        var found = false;\n        try {\n            for (var possiblePairs_1 = __values(possiblePairs), possiblePairs_1_1 = possiblePairs_1.next(); !possiblePairs_1_1.done; possiblePairs_1_1 = possiblePairs_1.next()) {\n                var other = possiblePairs_1_1.value;\n                if (other.getValue() === pair.getValue()) {\n                    other.incrementCount();\n                    found = true;\n                    break;\n                }\n            }\n        }\n        catch (e_3_1) { e_3 = { error: e_3_1 }; }\n        finally {\n            try {\n                if (possiblePairs_1_1 && !possiblePairs_1_1.done && (_a = possiblePairs_1.return)) _a.call(possiblePairs_1);\n            }\n            finally { if (e_3) throw e_3.error; }\n        }\n        if (!found) {\n            possiblePairs.push(pair);\n        }\n    };\n    RSS14Reader.prototype.reset = function () {\n        this.possibleLeftPairs.length = 0;\n        this.possibleRightPairs.length = 0;\n    };\n    RSS14Reader.constructResult = function (leftPair, rightPair) {\n        var symbolValue = 4537077 * leftPair.getValue() + rightPair.getValue();\n        var text = new String(symbolValue).toString();\n        var buffer = new StringBuilder_1.default();\n        for (var i = 13 - text.length; i > 0; i--) {\n            buffer.append('0');\n        }\n        buffer.append(text);\n        var checkDigit = 0;\n        for (var i = 0; i < 13; i++) {\n            var digit = buffer.charAt(i).charCodeAt(0) - '0'.charCodeAt(0);\n            checkDigit += ((i & 0x01) === 0) ? 3 * digit : digit;\n        }\n        checkDigit = 10 - (checkDigit % 10);\n        if (checkDigit === 10) {\n            checkDigit = 0;\n        }\n        buffer.append(checkDigit.toString());\n        var leftPoints = leftPair.getFinderPattern().getResultPoints();\n        var rightPoints = rightPair.getFinderPattern().getResultPoints();\n        return new Result_1.default(buffer.toString(), null, 0, [leftPoints[0], leftPoints[1], rightPoints[0], rightPoints[1]], BarcodeFormat_1.default.RSS_14, new Date().getTime());\n    };\n    RSS14Reader.checkChecksum = function (leftPair, rightPair) {\n        var checkValue = (leftPair.getChecksumPortion() + 16 * rightPair.getChecksumPortion()) % 79;\n        var targetCheckValue = 9 * leftPair.getFinderPattern().getValue() + rightPair.getFinderPattern().getValue();\n        if (targetCheckValue > 72) {\n            targetCheckValue--;\n        }\n        if (targetCheckValue > 8) {\n            targetCheckValue--;\n        }\n        return checkValue === targetCheckValue;\n    };\n    RSS14Reader.prototype.decodePair = function (row, right, rowNumber, hints) {\n        try {\n            var startEnd = this.findFinderPattern(row, right);\n            var pattern = this.parseFoundFinderPattern(row, rowNumber, right, startEnd);\n            var resultPointCallback = hints == null ? null : hints.get(DecodeHintType_1.default.NEED_RESULT_POINT_CALLBACK);\n            if (resultPointCallback != null) {\n                var center = (startEnd[0] + startEnd[1]) / 2.0;\n                if (right) {\n                    // row is actually reversed\n                    center = row.getSize() - 1 - center;\n                }\n                resultPointCallback.foundPossibleResultPoint(new ResultPoint_1.default(center, rowNumber));\n            }\n            var outside = this.decodeDataCharacter(row, pattern, true);\n            var inside = this.decodeDataCharacter(row, pattern, false);\n            return new Pair_1.default(1597 * outside.getValue() + inside.getValue(), outside.getChecksumPortion() + 4 * inside.getChecksumPortion(), pattern);\n        }\n        catch (err) {\n            return null;\n        }\n    };\n    RSS14Reader.prototype.decodeDataCharacter = function (row, pattern, outsideChar) {\n        var counters = this.getDataCharacterCounters();\n        for (var x = 0; x < counters.length; x++) {\n            counters[x] = 0;\n        }\n        if (outsideChar) {\n            OneDReader_1.default.recordPatternInReverse(row, pattern.getStartEnd()[0], counters);\n        }\n        else {\n            OneDReader_1.default.recordPattern(row, pattern.getStartEnd()[1] + 1, counters);\n            // reverse it\n            for (var i = 0, j = counters.length - 1; i < j; i++, j--) {\n                var temp = counters[i];\n                counters[i] = counters[j];\n                counters[j] = temp;\n            }\n        }\n        var numModules = outsideChar ? 16 : 15;\n        var elementWidth = MathUtils_1.default.sum(new Int32Array(counters)) / numModules;\n        var oddCounts = this.getOddCounts();\n        var evenCounts = this.getEvenCounts();\n        var oddRoundingErrors = this.getOddRoundingErrors();\n        var evenRoundingErrors = this.getEvenRoundingErrors();\n        for (var i = 0; i < counters.length; i++) {\n            var value = counters[i] / elementWidth;\n            var count = Math.floor(value + 0.5);\n            if (count < 1) {\n                count = 1;\n            }\n            else if (count > 8) {\n                count = 8;\n            }\n            var offset = Math.floor(i / 2);\n            if ((i & 0x01) === 0) {\n                oddCounts[offset] = count;\n                oddRoundingErrors[offset] = value - count;\n            }\n            else {\n                evenCounts[offset] = count;\n                evenRoundingErrors[offset] = value - count;\n            }\n        }\n        this.adjustOddEvenCounts(outsideChar, numModules);\n        var oddSum = 0;\n        var oddChecksumPortion = 0;\n        for (var i = oddCounts.length - 1; i >= 0; i--) {\n            oddChecksumPortion *= 9;\n            oddChecksumPortion += oddCounts[i];\n            oddSum += oddCounts[i];\n        }\n        var evenChecksumPortion = 0;\n        var evenSum = 0;\n        for (var i = evenCounts.length - 1; i >= 0; i--) {\n            evenChecksumPortion *= 9;\n            evenChecksumPortion += evenCounts[i];\n            evenSum += evenCounts[i];\n        }\n        var checksumPortion = oddChecksumPortion + 3 * evenChecksumPortion;\n        if (outsideChar) {\n            if ((oddSum & 0x01) !== 0 || oddSum > 12 || oddSum < 4) {\n                throw new NotFoundException_1.default();\n            }\n            var group = (12 - oddSum) / 2;\n            var oddWidest = RSS14Reader.OUTSIDE_ODD_WIDEST[group];\n            var evenWidest = 9 - oddWidest;\n            var vOdd = RSSUtils_1.default.getRSSvalue(oddCounts, oddWidest, false);\n            var vEven = RSSUtils_1.default.getRSSvalue(evenCounts, evenWidest, true);\n            var tEven = RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET[group];\n            var gSum = RSS14Reader.OUTSIDE_GSUM[group];\n            return new DataCharacter_1.default(vOdd * tEven + vEven + gSum, checksumPortion);\n        }\n        else {\n            if ((evenSum & 0x01) !== 0 || evenSum > 10 || evenSum < 4) {\n                throw new NotFoundException_1.default();\n            }\n            var group = (10 - evenSum) / 2;\n            var oddWidest = RSS14Reader.INSIDE_ODD_WIDEST[group];\n            var evenWidest = 9 - oddWidest;\n            var vOdd = RSSUtils_1.default.getRSSvalue(oddCounts, oddWidest, true);\n            var vEven = RSSUtils_1.default.getRSSvalue(evenCounts, evenWidest, false);\n            var tOdd = RSS14Reader.INSIDE_ODD_TOTAL_SUBSET[group];\n            var gSum = RSS14Reader.INSIDE_GSUM[group];\n            return new DataCharacter_1.default(vEven * tOdd + vOdd + gSum, checksumPortion);\n        }\n    };\n    RSS14Reader.prototype.findFinderPattern = function (row, rightFinderPattern) {\n        var counters = this.getDecodeFinderCounters();\n        counters[0] = 0;\n        counters[1] = 0;\n        counters[2] = 0;\n        counters[3] = 0;\n        var width = row.getSize();\n        var isWhite = false;\n        var rowOffset = 0;\n        while (rowOffset < width) {\n            isWhite = !row.get(rowOffset);\n            if (rightFinderPattern === isWhite) {\n                // Will encounter white first when searching for right finder pattern\n                break;\n            }\n            rowOffset++;\n        }\n        var counterPosition = 0;\n        var patternStart = rowOffset;\n        for (var x = rowOffset; x < width; x++) {\n            if (row.get(x) !== isWhite) {\n                counters[counterPosition]++;\n            }\n            else {\n                if (counterPosition === 3) {\n                    if (AbstractRSSReader_1.default.isFinderPattern(counters)) {\n                        return [patternStart, x];\n                    }\n                    patternStart += counters[0] + counters[1];\n                    counters[0] = counters[2];\n                    counters[1] = counters[3];\n                    counters[2] = 0;\n                    counters[3] = 0;\n                    counterPosition--;\n                }\n                else {\n                    counterPosition++;\n                }\n                counters[counterPosition] = 1;\n                isWhite = !isWhite;\n            }\n        }\n        throw new NotFoundException_1.default();\n    };\n    RSS14Reader.prototype.parseFoundFinderPattern = function (row, rowNumber, right, startEnd) {\n        // Actually we found elements 2-5\n        var firstIsBlack = row.get(startEnd[0]);\n        var firstElementStart = startEnd[0] - 1;\n        // Locate element 1\n        while (firstElementStart >= 0 && firstIsBlack !== row.get(firstElementStart)) {\n            firstElementStart--;\n        }\n        firstElementStart++;\n        var firstCounter = startEnd[0] - firstElementStart;\n        // Make 'counters' hold 1-4\n        var counters = this.getDecodeFinderCounters();\n        var copy = new Array(counters.length);\n        System_1.default.arraycopy(counters, 0, copy, 1, counters.length - 1);\n        copy[0] = firstCounter;\n        var value = this.parseFinderValue(copy, RSS14Reader.FINDER_PATTERNS);\n        var start = firstElementStart;\n        var end = startEnd[1];\n        if (right) {\n            // row is actually reversed\n            start = row.getSize() - 1 - start;\n            end = row.getSize() - 1 - end;\n        }\n        return new FinderPattern_1.default(value, [firstElementStart, startEnd[1]], start, end, rowNumber);\n    };\n    RSS14Reader.prototype.adjustOddEvenCounts = function (outsideChar, numModules) {\n        var oddSum = MathUtils_1.default.sum(new Int32Array(this.getOddCounts()));\n        var evenSum = MathUtils_1.default.sum(new Int32Array(this.getEvenCounts()));\n        var incrementOdd = false;\n        var decrementOdd = false;\n        var incrementEven = false;\n        var decrementEven = false;\n        if (outsideChar) {\n            if (oddSum > 12) {\n                decrementOdd = true;\n            }\n            else if (oddSum < 4) {\n                incrementOdd = true;\n            }\n            if (evenSum > 12) {\n                decrementEven = true;\n            }\n            else if (evenSum < 4) {\n                incrementEven = true;\n            }\n        }\n        else {\n            if (oddSum > 11) {\n                decrementOdd = true;\n            }\n            else if (oddSum < 5) {\n                incrementOdd = true;\n            }\n            if (evenSum > 10) {\n                decrementEven = true;\n            }\n            else if (evenSum < 4) {\n                incrementEven = true;\n            }\n        }\n        var mismatch = oddSum + evenSum - numModules;\n        var oddParityBad = (oddSum & 0x01) === (outsideChar ? 1 : 0);\n        var evenParityBad = (evenSum & 0x01) === 1;\n        if (mismatch === 1) {\n            if (oddParityBad) {\n                if (evenParityBad) {\n                    throw new NotFoundException_1.default();\n                }\n                decrementOdd = true;\n            }\n            else {\n                if (!evenParityBad) {\n                    throw new NotFoundException_1.default();\n                }\n                decrementEven = true;\n            }\n        }\n        else if (mismatch === -1) {\n            if (oddParityBad) {\n                if (evenParityBad) {\n                    throw new NotFoundException_1.default();\n                }\n                incrementOdd = true;\n            }\n            else {\n                if (!evenParityBad) {\n                    throw new NotFoundException_1.default();\n                }\n                incrementEven = true;\n            }\n        }\n        else if (mismatch === 0) {\n            if (oddParityBad) {\n                if (!evenParityBad) {\n                    throw new NotFoundException_1.default();\n                }\n                // Both bad\n                if (oddSum < evenSum) {\n                    incrementOdd = true;\n                    decrementEven = true;\n                }\n                else {\n                    decrementOdd = true;\n                    incrementEven = true;\n                }\n            }\n            else {\n                if (evenParityBad) {\n                    throw new NotFoundException_1.default();\n                }\n                // Nothing to do!\n            }\n        }\n        else {\n            throw new NotFoundException_1.default();\n        }\n        if (incrementOdd) {\n            if (decrementOdd) {\n                throw new NotFoundException_1.default();\n            }\n            AbstractRSSReader_1.default.increment(this.getOddCounts(), this.getOddRoundingErrors());\n        }\n        if (decrementOdd) {\n            AbstractRSSReader_1.default.decrement(this.getOddCounts(), this.getOddRoundingErrors());\n        }\n        if (incrementEven) {\n            if (decrementEven) {\n                throw new NotFoundException_1.default();\n            }\n            AbstractRSSReader_1.default.increment(this.getEvenCounts(), this.getOddRoundingErrors());\n        }\n        if (decrementEven) {\n            AbstractRSSReader_1.default.decrement(this.getEvenCounts(), this.getEvenRoundingErrors());\n        }\n    };\n    RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET = [1, 10, 34, 70, 126];\n    RSS14Reader.INSIDE_ODD_TOTAL_SUBSET = [4, 20, 48, 81];\n    RSS14Reader.OUTSIDE_GSUM = [0, 161, 961, 2015, 2715];\n    RSS14Reader.INSIDE_GSUM = [0, 336, 1036, 1516];\n    RSS14Reader.OUTSIDE_ODD_WIDEST = [8, 6, 4, 3, 1];\n    RSS14Reader.INSIDE_ODD_WIDEST = [2, 4, 6, 8];\n    RSS14Reader.FINDER_PATTERNS = [\n        [3, 8, 2, 1],\n        [3, 5, 5, 1],\n        [3, 3, 7, 1],\n        [3, 1, 9, 1],\n        [2, 7, 4, 1],\n        [2, 5, 6, 1],\n        [2, 3, 8, 1],\n        [1, 5, 7, 1],\n        [1, 3, 9, 1],\n    ];\n    return RSS14Reader;\n}(AbstractRSSReader_1.default));\nexports.default = RSS14Reader;\n//# sourceMappingURL=RSS14Reader.js.map"]},"metadata":{},"sourceType":"script"}