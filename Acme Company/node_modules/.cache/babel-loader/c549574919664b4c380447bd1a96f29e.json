{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright (C) 2010 ZXing authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __values = this && this.__values || function (o) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator],\n    i = 0;\n  if (m) return m.call(o);\n  return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar BarcodeFormat_1 = require(\"../BarcodeFormat\");\n// import UPCEANReader from './UPCEANReader';\nvar AbstractUPCEANReader_1 = require(\"./AbstractUPCEANReader\");\nvar Result_1 = require(\"../Result\");\nvar ResultPoint_1 = require(\"../ResultPoint\");\nvar ResultMetadataType_1 = require(\"../ResultMetadataType\");\nvar NotFoundException_1 = require(\"../NotFoundException\");\n/**\n * @see UPCEANExtension2Support\n */\nvar UPCEANExtension5Support = /** @class */function () {\n  function UPCEANExtension5Support() {\n    this.CHECK_DIGIT_ENCODINGS = [0x18, 0x14, 0x12, 0x11, 0x0C, 0x06, 0x03, 0x0A, 0x09, 0x05];\n    this.decodeMiddleCounters = [0, 0, 0, 0];\n    this.decodeRowStringBuffer = '';\n  }\n  UPCEANExtension5Support.prototype.decodeRow = function (rowNumber, row, extensionStartRange) {\n    var result = this.decodeRowStringBuffer;\n    var end = this.decodeMiddle(row, extensionStartRange, result);\n    var resultString = result.toString();\n    var extensionData = UPCEANExtension5Support.parseExtensionString(resultString);\n    var resultPoints = [new ResultPoint_1.default((extensionStartRange[0] + extensionStartRange[1]) / 2.0, rowNumber), new ResultPoint_1.default(end, rowNumber)];\n    var extensionResult = new Result_1.default(resultString, null, 0, resultPoints, BarcodeFormat_1.default.UPC_EAN_EXTENSION, new Date().getTime());\n    if (extensionData != null) {\n      extensionResult.putAllMetadata(extensionData);\n    }\n    return extensionResult;\n  };\n  UPCEANExtension5Support.prototype.decodeMiddle = function (row, startRange, resultString) {\n    var e_1, _a;\n    var counters = this.decodeMiddleCounters;\n    counters[0] = 0;\n    counters[1] = 0;\n    counters[2] = 0;\n    counters[3] = 0;\n    var end = row.getSize();\n    var rowOffset = startRange[1];\n    var lgPatternFound = 0;\n    for (var x = 0; x < 5 && rowOffset < end; x++) {\n      var bestMatch = AbstractUPCEANReader_1.default.decodeDigit(row, counters, rowOffset, AbstractUPCEANReader_1.default.L_AND_G_PATTERNS);\n      resultString += String.fromCharCode('0'.charCodeAt(0) + bestMatch % 10);\n      try {\n        for (var counters_1 = __values(counters), counters_1_1 = counters_1.next(); !counters_1_1.done; counters_1_1 = counters_1.next()) {\n          var counter = counters_1_1.value;\n          rowOffset += counter;\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (counters_1_1 && !counters_1_1.done && (_a = counters_1.return)) _a.call(counters_1);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n      if (bestMatch >= 10) {\n        lgPatternFound |= 1 << 4 - x;\n      }\n      if (x !== 4) {\n        // Read off separator if not last\n        rowOffset = row.getNextSet(rowOffset);\n        rowOffset = row.getNextUnset(rowOffset);\n      }\n    }\n    if (resultString.length !== 5) {\n      throw new NotFoundException_1.default();\n    }\n    var checkDigit = this.determineCheckDigit(lgPatternFound);\n    if (UPCEANExtension5Support.extensionChecksum(resultString.toString()) !== checkDigit) {\n      throw new NotFoundException_1.default();\n    }\n    return rowOffset;\n  };\n  UPCEANExtension5Support.extensionChecksum = function (s) {\n    var length = s.length;\n    var sum = 0;\n    for (var i = length - 2; i >= 0; i -= 2) {\n      sum += s.charAt(i).charCodeAt(0) - '0'.charCodeAt(0);\n    }\n    sum *= 3;\n    for (var i = length - 1; i >= 0; i -= 2) {\n      sum += s.charAt(i).charCodeAt(0) - '0'.charCodeAt(0);\n    }\n    sum *= 3;\n    return sum % 10;\n  };\n  UPCEANExtension5Support.prototype.determineCheckDigit = function (lgPatternFound) {\n    for (var d = 0; d < 10; d++) {\n      if (lgPatternFound === this.CHECK_DIGIT_ENCODINGS[d]) {\n        return d;\n      }\n    }\n    throw new NotFoundException_1.default();\n  };\n  UPCEANExtension5Support.parseExtensionString = function (raw) {\n    if (raw.length !== 5) {\n      return null;\n    }\n    var value = UPCEANExtension5Support.parseExtension5String(raw);\n    if (value == null) {\n      return null;\n    }\n    return new Map([[ResultMetadataType_1.default.SUGGESTED_PRICE, value]]);\n  };\n  UPCEANExtension5Support.parseExtension5String = function (raw) {\n    var currency;\n    switch (raw.charAt(0)) {\n      case '0':\n        currency = 'Â£';\n        break;\n      case '5':\n        currency = '$';\n        break;\n      case '9':\n        // Reference: http://www.jollytech.com\n        switch (raw) {\n          case '90000':\n            // No suggested retail price\n            return null;\n          case '99991':\n            // Complementary\n            return '0.00';\n          case '99990':\n            return 'Used';\n        }\n        // Otherwise... unknown currency?\n        currency = '';\n        break;\n      default:\n        currency = '';\n        break;\n    }\n    var rawAmount = parseInt(raw.substring(1));\n    var unitsString = (rawAmount / 100).toString();\n    var hundredths = rawAmount % 100;\n    var hundredthsString = hundredths < 10 ? '0' + hundredths : hundredths.toString(); // fixme\n    return currency + unitsString + '.' + hundredthsString;\n  };\n  return UPCEANExtension5Support;\n}();\nexports.default = UPCEANExtension5Support;","map":{"version":3,"names":["BarcodeFormat_1","require","AbstractUPCEANReader_1","Result_1","ResultPoint_1","ResultMetadataType_1","NotFoundException_1","UPCEANExtension5Support","CHECK_DIGIT_ENCODINGS","decodeMiddleCounters","decodeRowStringBuffer","prototype","decodeRow","rowNumber","row","extensionStartRange","result","end","decodeMiddle","resultString","toString","extensionData","parseExtensionString","resultPoints","default","extensionResult","UPC_EAN_EXTENSION","Date","getTime","putAllMetadata","startRange","counters","getSize","rowOffset","lgPatternFound","x","bestMatch","decodeDigit","L_AND_G_PATTERNS","String","fromCharCode","charCodeAt","counters_1","__values","counters_1_1","next","done","counter","value","getNextSet","getNextUnset","length","checkDigit","determineCheckDigit","extensionChecksum","s","sum","i","charAt","d","raw","parseExtension5String","Map","SUGGESTED_PRICE","currency","rawAmount","parseInt","substring","unitsString","hundredths","hundredthsString"],"sources":["../../../src/core/oned/UPCEANExtension5Support.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script"}